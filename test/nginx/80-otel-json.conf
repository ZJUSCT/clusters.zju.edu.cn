# http://nginx.org/en/docs/varindex.html
log_format otel_json escape=json '{'
  # https://opentelemetry.io/docs/specs/semconv/attributes-registry/http/
  '"http": {'
    '"request": {'
      '"header": {'
        '"x-forwarded-for": "$http_x_forwarded_for", '
        '"user-agent": "$http_user_agent", '
        '"host": "$http_host", '
        '"referer": "$http_referer", '
        '"content-length": "$content_length", '
        '"content-type": "$content_type"'
      '}, '
      '"method": "$request_method", '
      '"size": "$request_length"'
    '}, '
    '"response": {'
      '"body": {'
        '"size": "$bytes_sent"'
      '}, '
      '"status_code": "$status"'
    '}'
  '}, '
  # https://opentelemetry.io/docs/specs/semconv/attributes-registry/url/
  '"url": {'
    '"domain": "$host", '
    #'"original": "$scheme://$host$request_uri", '
    '"scheme": "$scheme", '
    '"path": "$uri", '
    '"query": "$args"'
  '}, '
  # https://opentelemetry.io/docs/specs/semconv/attributes-registry/client/
  '"client": {'
    '"address": "$remote_addr", '
    '"port": "$remote_port"'
  '}, '
  # https://opentelemetry.io/docs/specs/semconv/attributes-registry/server/
  '"server": {'
    '"address": "$server_addr", '
    '"port": "$server_port"'
  '}, '
  # https://opentelemetry.io/docs/specs/semconv/attributes-registry/process/
  '"resource": {'
    '"process": {'
      '"pid": "$pid"'
    '}'
  '}, '
  # other attributes
  '"timestamp": "$msec", '
  '"body": "$request", '
  '"nginx": {'
    '"connection_requests": "$connection_requests", '
    '"request_id": "$request_id", '
    '"request_time": "$request_time", '
    '"upstream": "$upstream_addr", '
    '"upstream_connect_time": "$upstream_connect_time", '
    '"upstream_header_time": "$upstream_header_time", '
    '"upstream_response_time": "$upstream_response_time", '
    '"upstream_response_length": "$upstream_response_length", '
    '"upstream_cache_status": "$upstream_cache_status", '
    '"ssl_protocol": "$ssl_protocol", '
    '"ssl_cipher": "$ssl_cipher", '
    '"server_protocol": "$server_protocol", '
    '"pipe": "$pipe", '
    '"bad_req": "$bad_req", '
    '"bad_ip": "$badip_ip", '
    '"geoip_country_code": "$geoip_country_code"'
  '}'
'}';