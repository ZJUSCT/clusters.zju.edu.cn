# https://opentelemetry.io/docs/collector/configuration/
# https://github.com/open-telemetry/opentelemetry-collector/blob/main/examples/local/otel-config.yaml
# Version: otelcol-contrib v0.111.0
# Date: 2024-10-14
# Environment Variables should be set in .env:
#
#   OTEL_BEARER_TOKEN=
#   SNMP_AUTH_KEY=
#   SNMP_PRIVATE_KEY=
#
# and docker compose file:
#
#   environment:
#     - OTEL_BEARER_TOKEN=${OTEL_BEARER_TOKEN}

extensions:
# https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/healthcheckextension
  health_check:
    endpoint: otelcol:13133
    response_body: 
      healthy: "ok"
  pprof:
    endpoint: otelcol:1777
  zpages:
    endpoint: otelcol:55679
  bearertokenauth:
    token: ${OTEL_BEARER_TOKEN}

receivers:
# https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/otlpreceiver
  otlp/with_auth:
    protocols:
      http:
        endpoint: otelcol:4318
        auth:
          authenticator: bearertokenauth
# https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/syslogreceiver
  syslog:
    udp:
      listen_address: otelcol:514
      add_attributes: true
      one_log_per_packet: true
    protocol: rfc3164
    # we configure all infrastructure to use the same timezone UTC +8
    location: Asia/Shanghai
    #operators:
    #  - type: router
    #    routes:
    #      - output: huawei_add_resource
    #        # before escape: %%\d+[^\/]+\/\d+\/.+\(.+\)
    #        expr: 'attributes.appname matches "%%\\d+[^\\/]+\\/\\d+\\/.+\\(.+\\)"'
    #    default: noop
    #  - id: huawei_add_resource
    #    type: add
    #    field: resource.device.manufacturer
    #    value: Huawei
    #    output: huawei_regex_parser
    #  - id: huawei_regex_parser
    #    type: regex_parser
    #    parse_from: attributes.appname
    #    parse_to: attributes.huawei
    #    regex: '%%(?P<version>\d+)(?P<module_name>[^\/]+)\/(?P<serverity>\d+)\/(?P<brief>.+)\((?P<type>.+)\)'
    #  - id: noop
    #    type: noop
# https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/collectdreceiver
#  collectd:

################
# SNMP for PDU #  
################
# https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/snmpreceiver
# https://oid-rep.orange-labs.fr/get/1.3.6.1.4.1.30966
# oid prefix: 1.3.6.1.4.1.30966.10.8
  snmp/pdu-30966-1:
    collection_interval: 1s
    endpoint: udp://pdu1:161
    version: v3
    security_level: auth_priv
    user: zjusct
    auth_type: "MD5"
    auth_password: ${SNMP_AUTH_KEY}
    privacy_type: "DES"
    privacy_password: ${SNMP_PRIVATE_KEY}
    resource_attributes: 
      device.id:
        scalar_oid: ".1.3.6.1.4.1.30966.10.8.1.1.0"
    attributes:
      pdu.port.type:
        enum: [ "input", "outlet" ]
      pdu.port.index:
        enum: [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", 
          "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", 
          "21", "22", "23", "24"]
    metrics:
      pdu.current:
        # 0.1A
        unit: "ampere"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.4.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"
      pdu.power_factor:
        # 0.01
        unit: "ratio"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.5.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"
      pdu.voltage:
        # V
        unit: "volt"
        gauge:
          value_type: int
        scalar_oids:
          # only input
          - oid: ".1.3.6.1.4.1.30966.10.8.2.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
      pdu.power:
        # W
        unit: "watt"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.6.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"
      pdu.energy:
        # 0.1kWh
        unit: "kWh"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.7.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"
  snmp/pdu-30966-2:
    collection_interval: 1s
    endpoint: udp://pdu2:161
    version: v3
    security_level: auth_priv
    user: zjusct
    auth_type: "MD5"
    auth_password: ${SNMP_AUTH_KEY}
    privacy_type: "DES"
    privacy_password: ${SNMP_PRIVATE_KEY}
    resource_attributes: 
      device.id:
        scalar_oid: ".1.3.6.1.4.1.30966.10.8.1.1.0"
    attributes:
      pdu.port.type:
        enum: [ "input", "outlet" ]
      pdu.port.index:
        enum: [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", 
          "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", 
          "21", "22", "23", "24"]
    metrics:
      pdu.current:
        # 0.1A
        unit: "ampere"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.4.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.4.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"
      pdu.power_factor:
        # 0.01
        unit: "ratio"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.5.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.5.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"
      pdu.voltage:
        # V
        unit: "volt"
        gauge:
          value_type: int
        scalar_oids:
          # only input
          - oid: ".1.3.6.1.4.1.30966.10.8.2.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
      pdu.power:
        # W
        unit: "watt"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.6.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.6.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"
      pdu.energy:
        # 0.1kWh
        unit: "kWh"
        gauge:
          value_type: int
        scalar_oids:
          - oid: ".1.3.6.1.4.1.30966.10.8.2.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: input
          - oid: ".1.3.6.1.4.1.30966.10.8.7.1.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "1"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.2.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "2"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.3.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "3"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.4.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "4"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.5.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "5"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.6.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "6"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.7.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "7"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.8.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "8"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.9.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "9"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.10.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "10"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.11.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "11"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.12.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "12"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.13.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "13"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.14.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "14"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.15.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "15"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.16.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "16"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.17.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "17"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.18.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "18"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.19.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "19"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.20.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "20"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.21.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "21"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.22.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "22"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.23.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "23"
          - oid: ".1.3.6.1.4.1.30966.10.8.7.24.0"
            resource_attributes:
              - device.id
            attributes:
              - name: pdu.port.type
                value: "outlet"
              - name: pdu.port.index
                value: "24"


processors:
# https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/resourceprocessor
  resource/cloud:
    attributes:
      - key: cloud.region
        value: "zjusct-cluster"
        action: insert
  resource/pdu-type:
    attributes:
      - key: device.type
        value: "pdu"
        action: insert
  resource/pdu-port-type-outlet:
    attributes:
      - key: pdu.port.type
        value: "outlet"
        action: insert
# https://github.com/open-telemetry/opentelemetry-collector/tree/main/processor/batchprocessor
  batch:
# https://github.com/open-telemetry/opentelemetry-collector/tree/main/processor/memorylimiterprocessor
  memory_limiter:
    check_interval: 1s
    limit_percentage: 50
    spike_limit_percentage: 30
  metricstransform/pdu-42578:
    transforms:
      - include: pdu.current
        action: update
        operations:
          - action: toggle_scalar_data_type 
          - action: experimental_scale_value
            experimental_scale: 0.01
      - include: pdu.voltage
        action: update
        operations:
          - action: toggle_scalar_data_type 
          - action: experimental_scale_value
            experimental_scale: 0.01
      - include: pdu.power_factor
        action: update
        operations:
          - action: toggle_scalar_data_type 
          - action: experimental_scale_value
            experimental_scale: 0.001
      - include: pdu.energy
        action: update
        operations:
          - action: toggle_scalar_data_type 
          - action: experimental_scale_value
            experimental_scale: 0.01
  metricstransform/pdu-30966:
    transforms:
      - include: pdu.current
        action: update
        operations:
          - action: toggle_scalar_data_type 
          - action: experimental_scale_value
            experimental_scale: 0.1
      - include: pdu.voltage
        action: update
        operations:
          - action: toggle_scalar_data_type 
      - include: pdu.power_factor
        action: update
        operations:
          - action: toggle_scalar_data_type 
          - action: experimental_scale_value
            experimental_scale: 0.01
      - include: pdu.energy
        action: update
        operations:
          - action: toggle_scalar_data_type 
          - action: experimental_scale_value
            experimental_scale: 0.1

exporters:
# https://github.com/open-telemetry/opentelemetry-collector/tree/main/exporter/debugexporter
  debug:
    # basic, normal, detailed
    verbosity: basic
# https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/clickhouseexporter
  clickhouse:
    endpoint: clickhouse://clickhouse:9000
    ttl: 4320h
# https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/prometheusexporter
  prometheus:
    endpoint: otelcol:9090
    send_timestamps: true
    resource_to_telemetry_conversion:
      enabled: true
# https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/fileexporter
  #file:
  #  path: /test/otel-collector.json
# https://github.com/open-telemetry/opentelemetry-collector/tree/main/exporter/nopexporter
  #nop:

service:
  extensions: [health_check, pprof, zpages, bearertokenauth]
  pipelines:
    logs:
      receivers: [syslog, otlp/with_auth]
      processors: [memory_limiter, batch, resource]
      exporters: [clickhouse]
    traces:
      receivers: [otlp/with_auth]
      processors: [memory_limiter, batch, resource]
      exporters: [clickhouse]
    metrics:
      receivers: [otlp/with_auth]
      processors: [memory_limiter, batch, resource]
      exporters: [prometheus]
    metrics/pdu-30966:
      receivers: [snmp/pdu-30966-1, snmp/pdu-30966-2]
      processors: [memory_limiter, batch, metricstransform/pdu-30966, resource/cloud]
      exporters: [prometheus]
    metrics/pdu-42578:
      receivers: [snmp/pdu-42578-1]
      processors: [memory_limiter, batch, metricstransform/pdu-42578, resource/cloud]
      exporters: [prometheus]